{"version":3,"file":"range-slider.js","sources":["../../src/js/components/range-slider.js"],"sourcesContent":["const selectors = {\n  sidebar: '[data-collection-sidebar]',\n  rangeDotLeft: '[data-range-left]',\n  rangeDotRight: '[data-range-right]',\n  rangeLine: '[data-range-line]',\n  rangeHolder: '[data-range-holder]',\n  dataMin: 'data-se-min',\n  dataMax: 'data-se-max',\n  dataMinValue: 'data-se-min-value',\n  dataMaxValue: 'data-se-max-value',\n  dataStep: 'data-se-step',\n  dataFilterUpdate: 'data-range-filter-update',\n  priceMin: '[data-field-price-min]',\n  priceMax: '[data-field-price-max]',\n};\n\nconst classes = {\n  initialized: 'is-initialized',\n};\n\nclass RangeSlider extends HTMLElement {\n  constructor() {\n    super();\n\n    this.sidebar = this.closest(selectors.sidebar);\n    this.sidebarTransitionEvent = (event) => this.onSidebarTransitionEnd(event);\n\n    this.resizeEvent = () => {\n      this.connectedCallback();\n      this.sidebar.addEventListener('transitionend', this.sidebarTransitionEvent);\n    };\n\n    this.onMoveEvent = (event) => this.onMove(event);\n    this.onStopEvent = (event) => this.onStop(event);\n    this.onStartEvent = (event) => this.onStart(event);\n    this.startX = 0;\n    this.x = 0;\n\n    // retrieve touch button\n    this.touchLeft = this.querySelector(selectors.rangeDotLeft);\n    this.touchRight = this.querySelector(selectors.rangeDotRight);\n    this.lineSpan = this.querySelector(selectors.rangeLine);\n\n    // get some properties\n    this.min = parseFloat(this.getAttribute(selectors.dataMin));\n    this.max = parseFloat(this.getAttribute(selectors.dataMax));\n\n    this.step = 0.0;\n\n    // normalize flag\n    this.normalizeFact = 26;\n\n    document.addEventListener('theme:resize:width', this.resizeEvent);\n  }\n\n  connectedCallback() {\n    // retrieve default values\n    let defaultMinValue = this.min;\n    if (this.hasAttribute(selectors.dataMinValue)) {\n      defaultMinValue = parseFloat(this.getAttribute(selectors.dataMinValue));\n    }\n    let defaultMaxValue = this.max;\n\n    if (this.hasAttribute(selectors.dataMaxValue)) {\n      defaultMaxValue = parseFloat(this.getAttribute(selectors.dataMaxValue));\n    }\n\n    // check values are correct\n    if (defaultMinValue < this.min) {\n      defaultMinValue = this.min;\n    }\n\n    if (defaultMaxValue > this.max) {\n      defaultMaxValue = this.max;\n    }\n\n    if (defaultMinValue > defaultMaxValue) {\n      defaultMinValue = defaultMaxValue;\n    }\n\n    if (this.getAttribute(selectors.dataStep)) {\n      this.step = Math.abs(parseFloat(this.getAttribute(selectors.dataStep)));\n    }\n\n    // initial reset\n    this.reset();\n\n    // usefull values, min, max, normalize fact is the width of both touch buttons\n    this.maxX = this.offsetWidth - this.touchRight.offsetWidth;\n    this.selectedTouch = null;\n    this.initialValue = this.lineSpan.offsetWidth - this.normalizeFact;\n\n    // set defualt values\n    this.setMinValue(defaultMinValue);\n    this.setMaxValue(defaultMaxValue);\n\n    // link events\n    this.touchLeft.addEventListener('mousedown', this.onStartEvent);\n    this.touchRight.addEventListener('mousedown', this.onStartEvent);\n    this.touchLeft.addEventListener('touchstart', this.onStartEvent, {passive: true});\n    this.touchRight.addEventListener('touchstart', this.onStartEvent, {passive: true});\n\n    // initialize\n    this.classList.add(classes.initialized);\n  }\n\n  reset() {\n    this.touchLeft.style.left = '0px';\n    this.touchRight.style.left = this.offsetWidth - this.touchLeft.offsetWidth + 'px';\n    this.lineSpan.style.marginLeft = '0px';\n    this.lineSpan.style.width = this.offsetWidth - this.touchLeft.offsetWidth + 'px';\n    this.startX = 0;\n    this.x = 0;\n  }\n\n  setMinValue(minValue) {\n    const ratio = (minValue - this.min) / (this.max - this.min);\n    this.touchLeft.style.left = Math.ceil(ratio * (this.offsetWidth - (this.touchLeft.offsetWidth + this.normalizeFact))) + 'px';\n    this.lineSpan.style.marginLeft = this.touchLeft.offsetLeft + 'px';\n    this.lineSpan.style.width = this.touchRight.offsetLeft - this.touchLeft.offsetLeft + 'px';\n    this.setAttribute(selectors.dataMinValue, minValue);\n  }\n\n  setMaxValue(maxValue) {\n    const ratio = (maxValue - this.min) / (this.max - this.min);\n    this.touchRight.style.left = Math.ceil(ratio * (this.offsetWidth - (this.touchLeft.offsetWidth + this.normalizeFact)) + this.normalizeFact) + 'px';\n    this.lineSpan.style.marginLeft = this.touchLeft.offsetLeft + 'px';\n    this.lineSpan.style.width = this.touchRight.offsetLeft - this.touchLeft.offsetLeft + 'px';\n    this.setAttribute(selectors.dataMaxValue, maxValue);\n  }\n\n  onStart(event) {\n    // Prevent default dragging of selected content\n    let eventTouch = event;\n\n    if (event.touches) {\n      eventTouch = event.touches[0];\n    }\n\n    if (event.currentTarget === this.touchLeft) {\n      this.x = this.touchLeft.offsetLeft;\n    } else if (event.currentTarget === this.touchRight) {\n      this.x = this.touchRight.offsetLeft;\n    }\n\n    this.startX = eventTouch.pageX - this.x;\n    this.selectedTouch = event.currentTarget;\n    document.addEventListener('mousemove', this.onMoveEvent);\n    document.addEventListener('mouseup', this.onStopEvent);\n    document.addEventListener('touchmove', this.onMoveEvent, {passive: true});\n    document.addEventListener('touchend', this.onStopEvent, {passive: true});\n  }\n\n  onMove(event) {\n    let eventTouch = event;\n\n    if (event.touches) {\n      eventTouch = event.touches[0];\n    }\n\n    this.x = eventTouch.pageX - this.startX;\n\n    if (this.selectedTouch === this.touchLeft) {\n      if (this.x > this.touchRight.offsetLeft - this.selectedTouch.offsetWidth + 10) {\n        this.x = this.touchRight.offsetLeft - this.selectedTouch.offsetWidth + 10;\n      } else if (this.x < 0) {\n        this.x = 0;\n      }\n\n      this.selectedTouch.style.left = this.x + 'px';\n    } else if (this.selectedTouch === this.touchRight) {\n      if (this.x < this.touchLeft.offsetLeft + this.touchLeft.offsetWidth - 10) {\n        this.x = this.touchLeft.offsetLeft + this.touchLeft.offsetWidth - 10;\n      } else if (this.x > this.maxX) {\n        this.x = this.maxX;\n      }\n      this.selectedTouch.style.left = this.x + 'px';\n    }\n\n    // update line span\n    this.lineSpan.style.marginLeft = this.touchLeft.offsetLeft + 'px';\n    this.lineSpan.style.width = this.touchRight.offsetLeft - this.touchLeft.offsetLeft + 'px';\n\n    // write new value\n    this.calculateValue();\n\n    // call on change\n    if (this.getAttribute('on-change')) {\n      const fn = new Function('min, max', this.getAttribute('on-change'));\n      fn(this.getAttribute(selectors.dataMinValue), this.getAttribute(selectors.dataMaxValue));\n    }\n\n    this.onChange(this.getAttribute(selectors.dataMinValue), this.getAttribute(selectors.dataMaxValue));\n  }\n\n  onStop() {\n    document.removeEventListener('mousemove', this.onMoveEvent);\n    document.removeEventListener('mouseup', this.onStopEvent);\n    document.removeEventListener('touchmove', this.onMoveEvent);\n    document.removeEventListener('touchend', this.onStopEvent);\n\n    this.selectedTouch = null;\n\n    // write new value\n    this.calculateValue();\n\n    // call did changed\n    this.onChanged(this.getAttribute(selectors.dataMinValue), this.getAttribute(selectors.dataMaxValue));\n  }\n\n  onChange(min, max) {\n    const rangeHolder = this.closest(selectors.rangeHolder);\n    if (rangeHolder) {\n      const priceMin = rangeHolder.querySelector(selectors.priceMin);\n      const priceMax = rangeHolder.querySelector(selectors.priceMax);\n\n      if (priceMin && priceMax) {\n        priceMin.value = min;\n        priceMax.value = max;\n      }\n    }\n  }\n\n  onChanged(min, max) {\n    if (this.hasAttribute(selectors.dataFilterUpdate)) {\n      this.dispatchEvent(new CustomEvent('theme:range:update', {bubbles: true}));\n    }\n  }\n\n  calculateValue() {\n    const newValue = (this.lineSpan.offsetWidth - this.normalizeFact) / this.initialValue;\n    let minValue = this.lineSpan.offsetLeft / this.initialValue;\n    let maxValue = minValue + newValue;\n\n    minValue = minValue * (this.max - this.min) + this.min;\n    maxValue = maxValue * (this.max - this.min) + this.min;\n\n    if (this.step !== 0.0) {\n      let multi = Math.floor(minValue / this.step);\n      minValue = this.step * multi;\n\n      multi = Math.floor(maxValue / this.step);\n      maxValue = this.step * multi;\n    }\n\n    if (this.selectedTouch === this.touchLeft) {\n      this.setAttribute(selectors.dataMinValue, minValue);\n    }\n\n    if (this.selectedTouch === this.touchRight) {\n      this.setAttribute(selectors.dataMaxValue, maxValue);\n    }\n  }\n\n  onSidebarTransitionEnd(event) {\n    if (event.target == this.sidebar && event.propertyName == 'min-width') {\n      this.sidebar.removeEventListener('transitionend', this.sidebarTransitionEvent);\n      this.connectedCallback();\n    }\n  }\n\n  disconnectedCallback() {\n    this.sidebar.removeEventListener('transitionend', this.sidebarTransitionEvent);\n\n    if (this.resizeEvent) {\n      document.removeEventListener('theme:resize:width', this.resizeEvent);\n    }\n  }\n}\n\nif (!customElements.get('range-slider')) {\n  customElements.define('range-slider', RangeSlider);\n}\n"],"names":["selectors","classes","RangeSlider","HTMLElement","constructor","super","this","sidebar","closest","sidebarTransitionEvent","event","onSidebarTransitionEnd","resizeEvent","connectedCallback","addEventListener","onMoveEvent","onMove","onStopEvent","onStop","onStartEvent","onStart","startX","x","touchLeft","querySelector","touchRight","lineSpan","min","parseFloat","getAttribute","max","step","normalizeFact","document","defaultMinValue","hasAttribute","defaultMaxValue","Math","abs","reset","maxX","offsetWidth","selectedTouch","initialValue","setMinValue","setMaxValue","passive","classList","add","style","left","marginLeft","width","minValue","ratio","ceil","offsetLeft","setAttribute","maxValue","eventTouch","touches","currentTarget","pageX","calculateValue","Function","fn","onChange","removeEventListener","onChanged","rangeHolder","priceMin","priceMax","value","dispatchEvent","CustomEvent","bubbles","newValue","multi","floor","target","propertyName","disconnectedCallback","customElements","get","define"],"mappings":"yBAAA,MAAMA,EACK,4BADLA,EAEU,oBAFVA,EAGW,qBAHXA,EAIO,oBAJPA,EAKS,sBALTA,EAMK,cANLA,EAOK,cAPLA,EAQU,oBARVA,EASU,oBATVA,EAUM,eAVNA,EAWc,2BAXdA,EAYM,yBAZNA,EAaM,yBAGNC,EACS,iBAGf,MAAMC,UAAoBC,YACxBC,cACEC,QAEAC,KAAKC,QAAUD,KAAKE,QAAQR,GAC5BM,KAAKG,uBAA0BC,GAAUJ,KAAKK,uBAAuBD,GAErEJ,KAAKM,YAAc,KACjBN,KAAKO,oBACLP,KAAKC,QAAQO,iBAAiB,gBAAiBR,KAAKG,uBAAuB,EAG7EH,KAAKS,YAAeL,GAAUJ,KAAKU,OAAON,GAC1CJ,KAAKW,YAAeP,GAAUJ,KAAKY,OAAOR,GAC1CJ,KAAKa,aAAgBT,GAAUJ,KAAKc,QAAQV,GAC5CJ,KAAKe,OAAS,EACdf,KAAKgB,EAAI,EAGThB,KAAKiB,UAAYjB,KAAKkB,cAAcxB,GACpCM,KAAKmB,WAAanB,KAAKkB,cAAcxB,GACrCM,KAAKoB,SAAWpB,KAAKkB,cAAcxB,GAGnCM,KAAKqB,IAAMC,WAAWtB,KAAKuB,aAAa7B,IACxCM,KAAKwB,IAAMF,WAAWtB,KAAKuB,aAAa7B,IAExCM,KAAKyB,KAAO,EAGZzB,KAAK0B,cAAgB,GAErBC,SAASnB,iBAAiB,qBAAsBR,KAAKM,YACtD,CAEDC,oBAEE,IAAIqB,EAAkB5B,KAAKqB,IACvBrB,KAAK6B,aAAanC,KACpBkC,EAAkBN,WAAWtB,KAAKuB,aAAa7B,KAEjD,IAAIoC,EAAkB9B,KAAKwB,IAEvBxB,KAAK6B,aAAanC,KACpBoC,EAAkBR,WAAWtB,KAAKuB,aAAa7B,KAI7CkC,EAAkB5B,KAAKqB,MACzBO,EAAkB5B,KAAKqB,KAGrBS,EAAkB9B,KAAKwB,MACzBM,EAAkB9B,KAAKwB,KAGrBI,EAAkBE,IACpBF,EAAkBE,GAGhB9B,KAAKuB,aAAa7B,KACpBM,KAAKyB,KAAOM,KAAKC,IAAIV,WAAWtB,KAAKuB,aAAa7B,MAIpDM,KAAKiC,QAGLjC,KAAKkC,KAAOlC,KAAKmC,YAAcnC,KAAKmB,WAAWgB,YAC/CnC,KAAKoC,cAAgB,KACrBpC,KAAKqC,aAAerC,KAAKoB,SAASe,YAAcnC,KAAK0B,cAGrD1B,KAAKsC,YAAYV,GACjB5B,KAAKuC,YAAYT,GAGjB9B,KAAKiB,UAAUT,iBAAiB,YAAaR,KAAKa,cAClDb,KAAKmB,WAAWX,iBAAiB,YAAaR,KAAKa,cACnDb,KAAKiB,UAAUT,iBAAiB,aAAcR,KAAKa,aAAc,CAAC2B,SAAS,IAC3ExC,KAAKmB,WAAWX,iBAAiB,aAAcR,KAAKa,aAAc,CAAC2B,SAAS,IAG5ExC,KAAKyC,UAAUC,IAAI/C,EACpB,CAEDsC,QACEjC,KAAKiB,UAAU0B,MAAMC,KAAO,MAC5B5C,KAAKmB,WAAWwB,MAAMC,KAAO5C,KAAKmC,YAAcnC,KAAKiB,UAAUkB,YAAc,KAC7EnC,KAAKoB,SAASuB,MAAME,WAAa,MACjC7C,KAAKoB,SAASuB,MAAMG,MAAQ9C,KAAKmC,YAAcnC,KAAKiB,UAAUkB,YAAc,KAC5EnC,KAAKe,OAAS,EACdf,KAAKgB,EAAI,CACV,CAEDsB,YAAYS,GACV,MAAMC,GAASD,EAAW/C,KAAKqB,MAAQrB,KAAKwB,IAAMxB,KAAKqB,KACvDrB,KAAKiB,UAAU0B,MAAMC,KAAOb,KAAKkB,KAAKD,GAAShD,KAAKmC,aAAenC,KAAKiB,UAAUkB,YAAcnC,KAAK0B,iBAAmB,KACxH1B,KAAKoB,SAASuB,MAAME,WAAa7C,KAAKiB,UAAUiC,WAAa,KAC7DlD,KAAKoB,SAASuB,MAAMG,MAAQ9C,KAAKmB,WAAW+B,WAAalD,KAAKiB,UAAUiC,WAAa,KACrFlD,KAAKmD,aAAazD,EAAwBqD,EAC3C,CAEDR,YAAYa,GACV,MAAMJ,GAASI,EAAWpD,KAAKqB,MAAQrB,KAAKwB,IAAMxB,KAAKqB,KACvDrB,KAAKmB,WAAWwB,MAAMC,KAAOb,KAAKkB,KAAKD,GAAShD,KAAKmC,aAAenC,KAAKiB,UAAUkB,YAAcnC,KAAK0B,gBAAkB1B,KAAK0B,eAAiB,KAC9I1B,KAAKoB,SAASuB,MAAME,WAAa7C,KAAKiB,UAAUiC,WAAa,KAC7DlD,KAAKoB,SAASuB,MAAMG,MAAQ9C,KAAKmB,WAAW+B,WAAalD,KAAKiB,UAAUiC,WAAa,KACrFlD,KAAKmD,aAAazD,EAAwB0D,EAC3C,CAEDtC,QAAQV,GAEN,IAAIiD,EAAajD,EAEbA,EAAMkD,UACRD,EAAajD,EAAMkD,QAAQ,IAGzBlD,EAAMmD,gBAAkBvD,KAAKiB,UAC/BjB,KAAKgB,EAAIhB,KAAKiB,UAAUiC,WACf9C,EAAMmD,gBAAkBvD,KAAKmB,aACtCnB,KAAKgB,EAAIhB,KAAKmB,WAAW+B,YAG3BlD,KAAKe,OAASsC,EAAWG,MAAQxD,KAAKgB,EACtChB,KAAKoC,cAAgBhC,EAAMmD,cAC3B5B,SAASnB,iBAAiB,YAAaR,KAAKS,aAC5CkB,SAASnB,iBAAiB,UAAWR,KAAKW,aAC1CgB,SAASnB,iBAAiB,YAAaR,KAAKS,YAAa,CAAC+B,SAAS,IACnEb,SAASnB,iBAAiB,WAAYR,KAAKW,YAAa,CAAC6B,SAAS,GACnE,CAED9B,OAAON,GACL,IAAIiD,EAAajD,EAiCjB,GA/BIA,EAAMkD,UACRD,EAAajD,EAAMkD,QAAQ,IAG7BtD,KAAKgB,EAAIqC,EAAWG,MAAQxD,KAAKe,OAE7Bf,KAAKoC,gBAAkBpC,KAAKiB,WAC1BjB,KAAKgB,EAAIhB,KAAKmB,WAAW+B,WAAalD,KAAKoC,cAAcD,YAAc,GACzEnC,KAAKgB,EAAIhB,KAAKmB,WAAW+B,WAAalD,KAAKoC,cAAcD,YAAc,GAC9DnC,KAAKgB,EAAI,IAClBhB,KAAKgB,EAAI,GAGXhB,KAAKoC,cAAcO,MAAMC,KAAO5C,KAAKgB,EAAI,MAChChB,KAAKoC,gBAAkBpC,KAAKmB,aACjCnB,KAAKgB,EAAIhB,KAAKiB,UAAUiC,WAAalD,KAAKiB,UAAUkB,YAAc,GACpEnC,KAAKgB,EAAIhB,KAAKiB,UAAUiC,WAAalD,KAAKiB,UAAUkB,YAAc,GACzDnC,KAAKgB,EAAIhB,KAAKkC,OACvBlC,KAAKgB,EAAIhB,KAAKkC,MAEhBlC,KAAKoC,cAAcO,MAAMC,KAAO5C,KAAKgB,EAAI,MAI3ChB,KAAKoB,SAASuB,MAAME,WAAa7C,KAAKiB,UAAUiC,WAAa,KAC7DlD,KAAKoB,SAASuB,MAAMG,MAAQ9C,KAAKmB,WAAW+B,WAAalD,KAAKiB,UAAUiC,WAAa,KAGrFlD,KAAKyD,iBAGDzD,KAAKuB,aAAa,aAAc,CACvB,IAAImC,SAAS,WAAY1D,KAAKuB,aAAa,aACtDoC,CAAG3D,KAAKuB,aAAa7B,GAAyBM,KAAKuB,aAAa7B,GACjE,CAEDM,KAAK4D,SAAS5D,KAAKuB,aAAa7B,GAAyBM,KAAKuB,aAAa7B,GAC5E,CAEDkB,SACEe,SAASkC,oBAAoB,YAAa7D,KAAKS,aAC/CkB,SAASkC,oBAAoB,UAAW7D,KAAKW,aAC7CgB,SAASkC,oBAAoB,YAAa7D,KAAKS,aAC/CkB,SAASkC,oBAAoB,WAAY7D,KAAKW,aAE9CX,KAAKoC,cAAgB,KAGrBpC,KAAKyD,iBAGLzD,KAAK8D,UAAU9D,KAAKuB,aAAa7B,GAAyBM,KAAKuB,aAAa7B,GAC7E,CAEDkE,SAASvC,EAAKG,GACZ,MAAMuC,EAAc/D,KAAKE,QAAQR,GACjC,GAAIqE,EAAa,CACf,MAAMC,EAAWD,EAAY7C,cAAcxB,GACrCuE,EAAWF,EAAY7C,cAAcxB,GAEvCsE,GAAYC,IACdD,EAASE,MAAQ7C,EACjB4C,EAASC,MAAQ1C,EAEpB,CACF,CAEDsC,UAAUzC,EAAKG,GACTxB,KAAK6B,aAAanC,IACpBM,KAAKmE,cAAc,IAAIC,YAAY,qBAAsB,CAACC,SAAS,IAEtE,CAEDZ,iBACE,MAAMa,GAAYtE,KAAKoB,SAASe,YAAcnC,KAAK0B,eAAiB1B,KAAKqC,aACzE,IAAIU,EAAW/C,KAAKoB,SAAS8B,WAAalD,KAAKqC,aAC3Ce,EAAWL,EAAWuB,EAK1B,GAHAvB,EAAWA,GAAY/C,KAAKwB,IAAMxB,KAAKqB,KAAOrB,KAAKqB,IACnD+B,EAAWA,GAAYpD,KAAKwB,IAAMxB,KAAKqB,KAAOrB,KAAKqB,IAEjC,IAAdrB,KAAKyB,KAAc,CACrB,IAAI8C,EAAQxC,KAAKyC,MAAMzB,EAAW/C,KAAKyB,MACvCsB,EAAW/C,KAAKyB,KAAO8C,EAEvBA,EAAQxC,KAAKyC,MAAMpB,EAAWpD,KAAKyB,MACnC2B,EAAWpD,KAAKyB,KAAO8C,CACxB,CAEGvE,KAAKoC,gBAAkBpC,KAAKiB,WAC9BjB,KAAKmD,aAAazD,EAAwBqD,GAGxC/C,KAAKoC,gBAAkBpC,KAAKmB,YAC9BnB,KAAKmD,aAAazD,EAAwB0D,EAE7C,CAED/C,uBAAuBD,GACjBA,EAAMqE,QAAUzE,KAAKC,SAAiC,aAAtBG,EAAMsE,eACxC1E,KAAKC,QAAQ4D,oBAAoB,gBAAiB7D,KAAKG,wBACvDH,KAAKO,oBAER,CAEDoE,uBACE3E,KAAKC,QAAQ4D,oBAAoB,gBAAiB7D,KAAKG,wBAEnDH,KAAKM,aACPqB,SAASkC,oBAAoB,qBAAsB7D,KAAKM,YAE3D,EAGEsE,eAAeC,IAAI,iBACtBD,eAAeE,OAAO,eAAgBlF"}